create table agencies (active boolean not null, created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6), phone varchar(15), cnpj varchar(18) not null unique, email varchar(100), name varchar(100) not null, address varchar(200), primary key (id));
create table availabilities (available_slots integer not null check (available_slots>=0), date date not null, price numeric(10,2) not null, total_slots integer not null check (total_slots>=1), agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, trip_id bigint not null, updated_at timestamp(6), primary key (id), unique (trip_id, date));
create table customers (created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6), cpf varchar(14) not null unique, phone varchar(20) not null, email varchar(100), name varchar(100) not null, primary key (id));
create table notifications (read boolean not null, agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, read_at timestamp(6), voucher_id bigint, message varchar(1000) not null, type enum ('ERROR','INFO','SUCCESS','TRIP_REMINDER','WARNING') not null, primary key (id));
create table package_images (created_at timestamp(6) not null, id bigint generated by default as identity, package_id bigint not null, image_url TEXT not null, primary key (id));
create table package_trips (package_id bigint not null, trip_id bigint not null);
create table password_reset_tokens (created_at timestamp(6) not null, expires_at timestamp(6) not null, id bigint generated by default as identity, used_at timestamp(6), user_id bigint not null, token_hash varchar(64) not null unique, primary key (id));
create table revoked_tokens (expires_at timestamp(6) not null, id bigint generated by default as identity, revoked_at timestamp(6) not null, token_hash varchar(64) not null unique, primary key (id));
create table travel_packages (active boolean not null, discount_percentage numeric(5,2) not null, agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6), name varchar(200) not null, description varchar(2000), primary key (id));
create table trips (price_per_person numeric(10,2) not null, agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6), destination varchar(100) not null, location varchar(200) not null, description varchar(2000) not null, image_url varchar(1000000), primary key (id));
create table users (active boolean not null, agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, last_login timestamp(6), updated_at timestamp(6), username varchar(50) not null unique, email varchar(100) not null unique, full_name varchar(100) not null, password varchar(255) not null, role enum ('ADMIN','USER') not null, primary key (id));
create table voucher_trips (passenger_count integer not null check (passenger_count>=1), total_price numeric(10,2) not null, trip_date date, created_at timestamp(6) not null, id bigint generated by default as identity, trip_id bigint not null, updated_at timestamp(6), voucher_id bigint not null, primary key (id));
create table vouchers (total_value numeric(10,2) not null, agency_id bigint not null, created_at timestamp(6) not null, customer_id bigint not null, id bigint generated by default as identity, sale_date timestamp(6) not null, updated_at timestamp(6), voucher_number varchar(50) not null unique, status enum ('ATIVO','CANCELADO','UTILIZADO') not null, primary key (id));
create index idx_password_reset_tokens_expires_at on password_reset_tokens (expires_at);
create index idx_revoked_tokens_expires_at on revoked_tokens (expires_at);
alter table if exists availabilities add constraint FKm2xy7k61yyrhuucvhgl8x5ydq foreign key (agency_id) references agencies;
alter table if exists availabilities add constraint FK9ara7w48s04q2jyb0t1yno30i foreign key (trip_id) references trips;
alter table if exists notifications add constraint FKj2grvqliyxkfq1850c2quisee foreign key (agency_id) references agencies;
alter table if exists notifications add constraint FKq3973egqlqydhal6xc3scf4b6 foreign key (voucher_id) references vouchers;
alter table if exists package_images add constraint FKr1xt1o4xwp7y2ew4g5i8i1a8c foreign key (package_id) references travel_packages;
alter table if exists package_trips add constraint FKg1qo9ieo6jnli3bmocbs03fhj foreign key (trip_id) references trips;
alter table if exists package_trips add constraint FKjqva472ik1gbckc37trltpolo foreign key (package_id) references travel_packages;
alter table if exists password_reset_tokens add constraint FKk3ndxg5xp6v7wd4gjyusp15gq foreign key (user_id) references users;
alter table if exists travel_packages add constraint FKkxet59qsslo8prxrqegtmf1dl foreign key (agency_id) references agencies;
alter table if exists trips add constraint FK69p0l6e618comd1vtlnjca7qx foreign key (agency_id) references agencies;
alter table if exists users add constraint FK7bo7u275rpljcaj3paqbaxbp9 foreign key (agency_id) references agencies;
alter table if exists voucher_trips add constraint FKllbpuu0u3vkr7cterg3bpwh9u foreign key (trip_id) references trips;
alter table if exists voucher_trips add constraint FKgoe24s1lqf90dqbipwqdiykkg foreign key (voucher_id) references vouchers;
alter table if exists vouchers add constraint FKt5x9wjay1r0pd6s5jq5jxhibr foreign key (agency_id) references agencies;
alter table if exists vouchers add constraint FKc4x7v4d80yddpy1k7exucbf6d foreign key (customer_id) references customers;
create table agencies (active boolean not null, created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6), phone varchar(15), cnpj varchar(18) not null unique, email varchar(100), name varchar(100) not null, address varchar(200), primary key (id));
create table availabilities (available_slots integer not null check (available_slots>=0), date date not null, price numeric(10,2) not null, total_slots integer not null check (total_slots>=1), agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, trip_id bigint not null, updated_at timestamp(6), primary key (id), unique (trip_id, date));
create table customers (created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6), cpf varchar(14) not null unique, phone varchar(20) not null, email varchar(100), name varchar(100) not null, primary key (id));
create table notifications (read boolean not null, agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, read_at timestamp(6), voucher_id bigint, message varchar(1000) not null, type enum ('ERROR','INFO','SUCCESS','TRIP_REMINDER','WARNING') not null, primary key (id));
create table package_images (created_at timestamp(6) not null, id bigint generated by default as identity, package_id bigint not null, image_url TEXT not null, primary key (id));
create table package_trips (package_id bigint not null, trip_id bigint not null);
create table password_reset_tokens (created_at timestamp(6) not null, expires_at timestamp(6) not null, id bigint generated by default as identity, used_at timestamp(6), user_id bigint not null, token_hash varchar(64) not null unique, primary key (id));
create table revoked_tokens (expires_at timestamp(6) not null, id bigint generated by default as identity, revoked_at timestamp(6) not null, token_hash varchar(64) not null unique, primary key (id));
create table travel_packages (active boolean not null, discount_percentage numeric(5,2) not null, agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6), name varchar(200) not null, description varchar(2000), primary key (id));
create table trips (price_per_person numeric(10,2) not null, agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6), destination varchar(100) not null, location varchar(200) not null, description varchar(2000) not null, image_url varchar(1000000), primary key (id));
create table users (active boolean not null, agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, last_login timestamp(6), updated_at timestamp(6), username varchar(50) not null unique, email varchar(100) not null unique, full_name varchar(100) not null, password varchar(255) not null, role enum ('ADMIN','USER') not null, primary key (id));
create table voucher_trips (passenger_count integer not null check (passenger_count>=1), total_price numeric(10,2) not null, trip_date date, created_at timestamp(6) not null, id bigint generated by default as identity, trip_id bigint not null, updated_at timestamp(6), voucher_id bigint not null, primary key (id));
create table vouchers (total_value numeric(10,2) not null, agency_id bigint not null, created_at timestamp(6) not null, customer_id bigint not null, id bigint generated by default as identity, sale_date timestamp(6) not null, updated_at timestamp(6), voucher_number varchar(50) not null unique, status enum ('ATIVO','CANCELADO','UTILIZADO') not null, primary key (id));
create index idx_password_reset_tokens_expires_at on password_reset_tokens (expires_at);
create index idx_revoked_tokens_expires_at on revoked_tokens (expires_at);
alter table if exists availabilities add constraint FKm2xy7k61yyrhuucvhgl8x5ydq foreign key (agency_id) references agencies;
alter table if exists availabilities add constraint FK9ara7w48s04q2jyb0t1yno30i foreign key (trip_id) references trips;
alter table if exists notifications add constraint FKj2grvqliyxkfq1850c2quisee foreign key (agency_id) references agencies;
alter table if exists notifications add constraint FKq3973egqlqydhal6xc3scf4b6 foreign key (voucher_id) references vouchers;
alter table if exists package_images add constraint FKr1xt1o4xwp7y2ew4g5i8i1a8c foreign key (package_id) references travel_packages;
alter table if exists package_trips add constraint FKg1qo9ieo6jnli3bmocbs03fhj foreign key (trip_id) references trips;
alter table if exists package_trips add constraint FKjqva472ik1gbckc37trltpolo foreign key (package_id) references travel_packages;
alter table if exists password_reset_tokens add constraint FKk3ndxg5xp6v7wd4gjyusp15gq foreign key (user_id) references users;
alter table if exists travel_packages add constraint FKkxet59qsslo8prxrqegtmf1dl foreign key (agency_id) references agencies;
alter table if exists trips add constraint FK69p0l6e618comd1vtlnjca7qx foreign key (agency_id) references agencies;
alter table if exists users add constraint FK7bo7u275rpljcaj3paqbaxbp9 foreign key (agency_id) references agencies;
alter table if exists voucher_trips add constraint FKllbpuu0u3vkr7cterg3bpwh9u foreign key (trip_id) references trips;
alter table if exists voucher_trips add constraint FKgoe24s1lqf90dqbipwqdiykkg foreign key (voucher_id) references vouchers;
alter table if exists vouchers add constraint FKt5x9wjay1r0pd6s5jq5jxhibr foreign key (agency_id) references agencies;
alter table if exists vouchers add constraint FKc4x7v4d80yddpy1k7exucbf6d foreign key (customer_id) references customers;
create table agencies (active boolean not null, created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6), phone varchar(15), cnpj varchar(18) not null unique, email varchar(100), name varchar(100) not null, address varchar(200), primary key (id));
create table availabilities (available_slots integer not null check (available_slots>=0), date date not null, price numeric(10,2) not null, total_slots integer not null check (total_slots>=1), agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, trip_id bigint not null, updated_at timestamp(6), primary key (id), unique (trip_id, date));
create table customers (created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6), cpf varchar(14) not null unique, phone varchar(20) not null, email varchar(100), name varchar(100) not null, primary key (id));
create table notifications (read boolean not null, agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, read_at timestamp(6), voucher_id bigint, message varchar(1000) not null, type enum ('ERROR','INFO','SUCCESS','TRIP_REMINDER','WARNING') not null, primary key (id));
create table package_images (created_at timestamp(6) not null, id bigint generated by default as identity, package_id bigint not null, image_url TEXT not null, primary key (id));
create table package_trips (package_id bigint not null, trip_id bigint not null);
create table password_reset_tokens (created_at timestamp(6) not null, expires_at timestamp(6) not null, id bigint generated by default as identity, used_at timestamp(6), user_id bigint not null, token_hash varchar(64) not null unique, primary key (id));
create table revoked_tokens (expires_at timestamp(6) not null, id bigint generated by default as identity, revoked_at timestamp(6) not null, token_hash varchar(64) not null unique, primary key (id));
create table travel_packages (active boolean not null, discount_percentage numeric(5,2) not null, agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6), name varchar(200) not null, description varchar(2000), primary key (id));
create table trips (price_per_person numeric(10,2) not null, agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6), destination varchar(100) not null, location varchar(200) not null, description varchar(2000) not null, image_url varchar(1000000), primary key (id));
create table users (active boolean not null, agency_id bigint not null, created_at timestamp(6) not null, id bigint generated by default as identity, last_login timestamp(6), updated_at timestamp(6), username varchar(50) not null unique, email varchar(100) not null unique, full_name varchar(100) not null, password varchar(255) not null, role enum ('ADMIN','USER') not null, primary key (id));
create table voucher_trips (passenger_count integer not null check (passenger_count>=1), total_price numeric(10,2) not null, trip_date date, created_at timestamp(6) not null, id bigint generated by default as identity, trip_id bigint not null, updated_at timestamp(6), voucher_id bigint not null, primary key (id));
create table vouchers (total_value numeric(10,2) not null, agency_id bigint not null, created_at timestamp(6) not null, customer_id bigint not null, id bigint generated by default as identity, sale_date timestamp(6) not null, updated_at timestamp(6), voucher_number varchar(50) not null unique, status enum ('ATIVO','CANCELADO','UTILIZADO') not null, primary key (id));
create index idx_password_reset_tokens_expires_at on password_reset_tokens (expires_at);
create index idx_revoked_tokens_expires_at on revoked_tokens (expires_at);
alter table if exists availabilities add constraint FKm2xy7k61yyrhuucvhgl8x5ydq foreign key (agency_id) references agencies;
alter table if exists availabilities add constraint FK9ara7w48s04q2jyb0t1yno30i foreign key (trip_id) references trips;
alter table if exists notifications add constraint FKj2grvqliyxkfq1850c2quisee foreign key (agency_id) references agencies;
alter table if exists notifications add constraint FKq3973egqlqydhal6xc3scf4b6 foreign key (voucher_id) references vouchers;
alter table if exists package_images add constraint FKr1xt1o4xwp7y2ew4g5i8i1a8c foreign key (package_id) references travel_packages;
alter table if exists package_trips add constraint FKg1qo9ieo6jnli3bmocbs03fhj foreign key (trip_id) references trips;
alter table if exists package_trips add constraint FKjqva472ik1gbckc37trltpolo foreign key (package_id) references travel_packages;
alter table if exists password_reset_tokens add constraint FKk3ndxg5xp6v7wd4gjyusp15gq foreign key (user_id) references users;
alter table if exists travel_packages add constraint FKkxet59qsslo8prxrqegtmf1dl foreign key (agency_id) references agencies;
alter table if exists trips add constraint FK69p0l6e618comd1vtlnjca7qx foreign key (agency_id) references agencies;
alter table if exists users add constraint FK7bo7u275rpljcaj3paqbaxbp9 foreign key (agency_id) references agencies;
alter table if exists voucher_trips add constraint FKllbpuu0u3vkr7cterg3bpwh9u foreign key (trip_id) references trips;
alter table if exists voucher_trips add constraint FKgoe24s1lqf90dqbipwqdiykkg foreign key (voucher_id) references vouchers;
alter table if exists vouchers add constraint FKt5x9wjay1r0pd6s5jq5jxhibr foreign key (agency_id) references agencies;
alter table if exists vouchers add constraint FKc4x7v4d80yddpy1k7exucbf6d foreign key (customer_id) references customers;
